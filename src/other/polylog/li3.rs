#![allow(clippy::all)]

use crate::approximations::polynomial;
use std::convert::identity;

approx_fn! {
    fn _lower(mod = lower, type = chebyshev, outer = identity, inner = identity);
}
approx_fn! {
    fn _upper(mod = upper, type = chebyshev, outer = identity, inner = identity);
}

#[inline]
pub(crate) fn eval(x: f64) -> f64 {
    if x < 0.0 {
        _lower(x)
    } else {
        _upper(x)
    }
}

pub(crate) mod lower {
    use super::*;

    pub fn lower(x: f64) -> f64 {
        polynomial(
            x.recip(),
            &[
                0.0,
                1.,
                0.125,
                0.03703703703703704,
                0.015625,
                0.008,
                0.00462962962962963,
                0.002915451895043732,
                0.001953125,
                0.001371742112482853,
                0.001,
            ],
        ) + polynomial(
            (-x).ln(),
            &[0.0, -1.644934066848226, 0.0, -0.1666666666666667],
        )
    }

    pub fn upper(x: f64) -> f64 {
        polynomial(
            x,
            &[
                0.0,
                1.,
                0.125,
                0.03703703703703704,
                0.015625,
                0.008,
                0.00462962962962963,
                0.002915451895043732,
                0.001953125,
                0.001371742112482853,
                0.001,
            ],
        )
    }

    pub const COEFFICIENTS: [&[f64]; 3] = [
        &[
            -5.30176859072544,
            1.288635784921124,
            0.04468541800764721,
            0.002860090929358415,
            0.0002331611546474979,
            0.00002168558680098558,
            2.192879272353469e-6,
            2.350168508673981e-7,
            2.629103200243845e-8,
            3.039919537808066e-9,
            3.608520232395661e-10,
            4.376293080804885e-11,
            5.402978124247433e-12,
            6.772013301863348e-13,
            8.598616071098789e-14,
            1.104136523214867e-14,
            1.431852821623746e-15,
            1.873096715466499e-16,
            2.469425086737847e-17,
            3.278370859115252e-18,
            4.379772852831813e-19,
            5.884683080387272e-20,
            7.947921552773693e-21,
            1.078580107330448e-21,
            1.470119079704118e-22,
            2.01190117837252e-23,
            2.763658490586911e-24,
            3.809539688926374e-25,
            5.270127713958969e-26,
            7.449049258554663e-27,
            1.016437454011598e-27,
        ],
        &[
            -3.156561259485994,
            0.8305167373261644,
            0.02289118801009311,
            0.001221716737055214,
            0.00008477833532250079,
            6.790340364411779e-6,
            5.95801375847516e-7,
            5.570026084764908e-8,
            5.456973798892645e-9,
            5.542670197875668e-10,
            5.7937040258561e-11,
            6.199639065795648e-12,
            6.76461244039257e-13,
            7.503814206141656e-14,
            8.442368037875469e-15,
            9.6156020047577e-16,
            1.107030053485477e-16,
            1.286680776393377e-17,
            1.508200372272124e-18,
            1.781327582088652e-19,
            2.118369330550488e-20,
            2.534867959421335e-21,
            3.05045779916368e-22,
            3.689962969466075e-23,
            4.484803880073517e-24,
            5.474799850145583e-25,
            6.71048130523666e-26,
            8.25608587707016e-27,
            1.019566367119868e-27,
            1.282153934171435e-28,
            1.568739805453647e-29,
        ],
        &[
            -1.236052151995515,
            1.11688419808365,
            0.05638972728891764,
            0.006044787653369532,
            0.0008792602136051412,
            0.000151306984857842,
            0.0000289843645027266,
            5.982452883713354e-6,
            1.304696963746165e-6,
            2.968519291016444e-7,
            6.985220991624027e-8,
            1.689315020703146e-8,
            4.179375817863105e-9,
            1.05399899214326e-9,
            2.702041669841708e-10,
            7.025986583885455e-11,
            1.84973295651697e-11,
            4.923331906983864e-12,
            1.323204634746091e-12,
            3.587292295756211e-13,
            9.80166498985535e-14,
            2.697132175094992e-14,
            7.469547607779318e-15,
            2.080813432750432e-15,
            5.827824160652138e-16,
            1.640320228631234e-16,
            4.638207313636265e-17,
            1.317690470546334e-17,
            3.779800989858259e-18,
            1.16289895311432e-18,
            3.083560729186375e-19,
        ],
    ];

    pub const SPLITS: [f64; 4] = [
        -11.5423320080549,
        -5.79919229141438,
        -2.92762243309412,
        -0.05605257477385986,
    ];
}

pub(crate) mod upper {
    use super::*;

    pub fn lower(x: f64) -> f64 {
        polynomial(
            x,
            &[
                0.0,
                1.,
                0.125,
                0.03703703703703704,
                0.015625,
                0.008,
                0.00462962962962963,
                0.002915451895043732,
                0.001953125,
                0.001371742112482853,
                0.001,
            ],
        )
    }

    pub fn upper(x: f64) -> f64 {
        if x == 1.0 {
            return 1.202056903159594;
        }

        let xm1 = x - 1.0;
        let ln = (-xm1).ln();
        polynomial(
            xm1,
            &[
                1.202056903159594,
                1.644934066848226,
                -0.07246703342411322,
                -0.03502197771725785,
                0.0436275943990545,
                -0.03906874218591027,
                0.03320543330307337,
                -0.02806497457723749,
                0.02387126602038893,
                -0.02049690136556617,
                0.01777304897151397,
            ],
        ) + ln
            * polynomial(
                xm1,
                &[
                    0.0,
                    0.0,
                    -0.5,
                    0.5,
                    -0.4583333333333333,
                    0.4166666666666667,
                    -0.3805555555555556,
                    0.35,
                    -0.3241071428571429,
                    0.301984126984127,
                    -0.2828968253968254,
                ],
            )
    }

    pub const COEFFICIENTS: [&[f64]; 3] = [
        &[
            0.2973023653624795,
            0.2453897502297611,
            0.004310104608215281,
            0.0001907592193741403,
            0.00001237876327550222,
            9.90570250826374e-7,
            9.0454167021354e-8,
            9.04363771317794e-9,
            9.65904749697247e-10,
            1.084747233144374e-10,
            1.267216979527393e-11,
            1.528199343863165e-12,
            1.891786413755496e-13,
            2.393745699653299e-14,
            3.085779386910818e-15,
            4.042035850181681e-16,
            5.368752284910191e-17,
            7.218411209316612e-18,
            9.81049620857342e-19,
            1.346195860076079e-19,
            1.863202895809392e-20,
            2.59882788486153e-21,
            3.650423806360555e-22,
            5.160397261195511e-23,
            7.337669285583796e-24,
            1.048959977669723e-24,
            1.506957806753243e-25,
            2.17482967225768e-26,
            3.153350418691743e-27,
            4.684070604753518e-28,
            6.696837093339477e-29,
        ],
        &[
            0.6843212925169583,
            0.1388181273509468,
            0.00176398825436781,
            0.00006408678992533133,
            3.623182112958607e-6,
            2.603622137611044e-7,
            2.171236022576007e-8,
            2.002590563690444e-9,
            1.98590021432655e-10,
            2.07975822211785e-11,
            2.272589489850901e-12,
            2.569201019877003e-13,
            2.986468086709248e-14,
            3.552898855734346e-15,
            4.31042441759696e-16,
            5.318008895859851e-17,
            6.657232486863819e-18,
            8.44036264812978e-19,
            1.082177463015602e-19,
            1.401400227586412e-20,
            1.831026402662494e-21,
            2.411609606836542e-22,
            3.199383822174069e-23,
            4.272530345302579e-24,
            5.740022533078628e-25,
            7.754131608082076e-26,
            1.052814202675044e-26,
            1.436158030589424e-27,
            1.968264950587795e-28,
            2.758181323400317e-29,
            3.73667154671908e-30,
        ],
        &[
            0.979716303083765,
            0.1578066490659567,
            0.003287204262883793,
            0.0002553996760423843,
            0.00003541198865504625,
            6.679189450409832e-6,
            1.515560210256904e-6,
            3.883409165902097e-7,
            1.083837290320816e-7,
            3.22208235078395e-8,
            1.005445345380527e-8,
            3.260080106461708e-9,
            1.090396609901267e-9,
            3.741815680942288e-10,
            1.312007711913952e-10,
            4.685502252969894e-11,
            1.699958883674904e-11,
            6.253070647357556e-12,
            2.328053398622382e-12,
            8.760607779148835e-13,
            3.328221709151351e-13,
            1.275263457320375e-13,
            4.924169395977793e-14,
            1.914691775592451e-14,
            7.492570966622936e-15,
            2.949315986622555e-15,
            1.167726313237017e-15,
            4.660173149156929e-16,
            1.902646581440957e-16,
            8.645663995211979e-17,
            2.994332335318137e-17,
        ],
    ];

    pub const SPLITS: [f64; 4] = [
        0.05564978142784834,
        0.5085676805840397,
        0.7350266301621354,
        0.961485579740231,
    ];
}
